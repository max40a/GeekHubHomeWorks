4.1. Топ 5 стран по количеству регионов, сортировка DESC по количеству регионов. Если количество регионов совпадает - ASC по имени (country_name, region_count);
4.2. Топ 5 стран по количеству городов, сортировка DESC по количеству городов.  Если количество городов совпадает - ASC по имени (country_name, city_count);
4.3. Все страны с количеством регионов и городов: Сортировка  city_count DESC, region_count DESC, country_name ASC
(country_name, region_сount, city_count)


решение 1:

запрос :
SELECT
  c.name,
  COUNT(*) region_count
FROM country c INNER JOIN region r
    ON c.id = r.country_id
GROUP BY c.name
ORDER BY region_count DESC, c.name ASC
LIMIT 5;

выборка :
Италия	    100
Франция		93
Россия		79
Польша		60
США			53


решение 2:

запрс:
SELECT
  c.name,
  SUM(city_count) city_count
FROM country c INNER JOIN
  (SELECT
     r.country_id id,
     r.name,
     COUNT(*)     city_count
   FROM city c INNER JOIN region r
       ON r.id = c.region_id
   GROUP BY r.name) p
    ON c.id = p.id
GROUP BY c.id
ORDER BY city_count DESC, c.name ASC
LIMIT 5;

выборка:
Россия		2568
Германия	2079
США			1559
Италия		814
Украина	    730


решение 3:

запрос :
SELECT
  c.name,
  COUNT(*)           region_count,
  SUM(p.sum_of_city) city_count
FROM country c INNER JOIN
  (SELECT
     r.country_id,
     r.name   region_name,
     COUNT(*) sum_of_city
   FROM region r INNER JOIN city c ON r.id = c.region_id
   GROUP BY r.id) p ON c.id = p.country_id
GROUP BY c.id
ORDER BY c.name, region_count DESC, city_count DESC;

выборка:

Абхазия					    1		10
Австралия				    9		208
Австрия					    9		186
Азербайджан			        3		76
Албания					    12	    41
Алжир						1		10
Ангола						1		7
Ангуилья					1		2
Андорра					    8		19
Антигуа и Барбуда	        1		8
Антильские о-ва		        1		1
Аргентина				    24	    184
Армения					    12	    247
Арулько					    1		1
Афганистан				    1		6
Багамские о-ва		        1		1
Бангладеш				    1		2
Барбадос					1		1
Бахрейн					    1		2
Беларусь					6		153
Белиз						1		1
Бельгия					    11	    203
Бенин						1		1
Бермуды					    1		1
Болгария					29	    371
Боливия					    8		34
Босния/Герцеговина	        3	    26
Ботсвана					1		3
Бразилия					21	    99
Британские Виргинские о-ва	1	    1
Бруней	                    1	    1
Буркина Фасо	            1	    2
Бурунди	                    1	    1
Бутан	                    1	    1
Валлис и Футуна о-ва	    1	    1
Вануату	                    1	    2
Великобритания	            17	    468
Венгрия	                    23	    83
Венесуэла	                23	    72
Восточный Тимор	            1	    1
Вьетнам	                    6	    11
Габон	                    1	    2
Гаити	                    6	    6
Гайана	                    1	    1
Гамбия	                    1	    1
Гана	                    1	    1
Гваделупа	                2	    2
Гватемала	                11	    20
Гвинея	                    1	    2
Гвинея-Бисау	            1	    1
Германия	                15	    2079
Гернси о-в	                1	    1
Гибралтар	                1	    6
Гондурас	                1	    1
Гонконг	                    1	    1
Гренада	                    1	    1
Гренландия	                1	    1
Греция	                    51	    333
Грузия	                    2	    66
Дания	                    16	    318
Джерси о-в	                1	    1
Джибути	                    1	    1
Доминиканская республика	1	    1
Египет	                    8	    10
Замбия	                    1	    3
Западная Сахара	            1	    2
Зимбабве	                1	    2
Израиль	                    8	    71
Индия	                    22	    63
Индонезия	                1	    1
Иордания	                1	    1
Ирак	                    3	    3
Иран	                    12	    16
Ирландия	                26	    131
Исландия	                11	    17
Испания	                    52	    590
Италия	                    100	    814
Йемен	                    1	    2
Кабо-Верде	                1	    1
Казахстан	                19	    251
Камбоджа	                1	    1
Камерун	                    4	    4
Канада	                    13	    248
Катар	                    1	    1
Кения	                    5	    12
Кипр	                    2	    6
Кирибати	                1	    9
Китай	                    30	    255
Колумбия	                19	    54
Коморские о-ва	            1	    1
Конго (Brazzaville)	        1	    3
Конго (Kinshasa)	        1	    1
Коста-Рика	                7	    32
Кот-д''Ивуар	            1	    2
Куба	                    15	    69
Кувейт	                    2	    2
Кука о-ва	                1	    1
Кыргызстан	                5	    73
Лаос	                    1	    1
Латвия	                    1	    57
Лесото	                    1	    1
Либерия	                    1	    1
Ливан	                    1	    2
Ливия	                    2	    2
Литва	                    1	    81
Лихтенштейн	                6	    6
Люксембург	                4	    38
Маврикий	                1	    1
Мавритания	                1	    1
Мадагаскар	                1	    6
Македония	                24	    28
Малави	                    1	    1
Малайзия	                1	    1
Мали	                    1	    3
Мальдивские о-ва	        1	    1
Мальта	                    1	    40
Марокко	                    2	    2
Мартиника о-в	            1	    1
Мексика	                    32	    170
Мозамбик	                1	    4
Молдова	                    1	    61
Монако	                    1	    7
Монголия	                1	    3
Мьянма (Бирма)	            1	    2
Мэн о-в	                    1	    6
Намибия	                    1	    3
Науру	                    1	    3
Непал	                    1	    1
Нигер	                    1	    5
Нигерия	                    1	    2
Нидерланды (Голландия)	    12	    280
Никарагуа	                4	    7
Новая Зеландия	            14	    21
Новая Каледония о-в	        1	    1
Норвегия	                20	    248
Норфолк о-в	                1	    1
О.А.Э.	                    2	    2
Оман	                    1	    3
Пакистан	                1	    3
Панама	                    5	    13
Папуа Новая Гвинея	        1	    2
Парагвай	                5	    9
Перу	                    23	    62
Питкэрн о-в	                1	    1
Польша	                    60	    325
Португалия	                21	    277
Пуэрто Рико	                1	    15
Реюньон	                    1	    1
Россия	                    79	    2568
Руанда	                    1	    1
Румыния	                    42	    264
Сальвадор	                6	    6
Самоа	                    1	    2
Сан-Марино	                3	    4
Сан-Томе и Принсипи	        1	    1
Саудовская Аравия	        1	    6
Свазиленд	                1	    1
Святая Люсия	            1	    1
Святой Елены о-в	        1	    1
Северная Корея	            1	    1
Сейшеллы	                1	    1
Сен-Пьер и Микелон	        1	    1
Сенегал	                    1	    1
Сент Китс и Невис	        1	    1
Сент-Винсент и Гренадины	1	    1
Сербия	                    3	    20
Сингапур	                1	    1
Сирия	                    1	    1
Словакия	                7	    16
Словения	                3	    12
Соломоновы о-ва	            1	    1
Сомали	                    1	    1
Судан	                    1	    8
Суринам	                    1	    1
США	                        40	    1578
Сьерра-Леоне	            1	    1
Таджикистан	                5	    58
Таиланд	                    3	    3
Тайвань	                    1	    1
Танзания	                1	    4
Того	                    1	    1
Токелау о-ва	            1	    1
Тонга	                    1	    1
Тринидад и Тобаго	        1	    1
Тувалу	                    1	    1
Тунис	                    1	    1
Туркменистан	            5	    40
Туркс и Кейкос	            1	    2
Турция	                    36	    37
Уганда	                    2	    2
Узбекистан	                13	    108
Украина	                    25	    730
Уругвай	                    11	    20
Фарерские о-ва	            1	    1
Фиджи	                    1	    2
Филиппины	                1	    7
Финляндия	                7	    301
Франция	                    92	    545
Французская Гвинея	        1	    3
Французская Полинезия	    1	    1
Хорватия	                12	    32
Чад	                        1	    3
Черногория	                1	    7
Чехия	                    15	    116
Чили	                    13	    63
Швейцария	                26	    222
Швеция	                    22	    285
Шри-Ланка	                1	    1
Эквадор	                    13	    28
Экваториальная Гвинея	    1	    1
Эритрея	                    1	    1
Эстония	                    1	    39
Эфиопия	                    1	    3
ЮАР	                        1	    1
Южная Корея	                17	    31
Южная Осетия	            1	    2
Япония	                    38	    122
